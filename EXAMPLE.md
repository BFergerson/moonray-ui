# orbital

### all_percentile table
```csv
id,value,cal_precision,dataset,time_bucket
202104110124,"0,200|1,200|2,370|3,370|4,370",10,"14,1|37,1|20,1",202104110124
202104102347,"0,160|1,210|2,270|3,280|4,370",10,"22,4|45,1|23,2|24,2|25,3|27,3|28,1|29,1|30,1|10,2|11,1|12,2|13,1|14,1|15,2|37,1|16,5|17,2|18,2|19,4|0,8|1,3|3,1|4,3|5,5|6,3|7,2|9,2|20,4|21,3",202104102347
202104102313,"0,180|1,240|2,360|3,390|4,430",10,"22,7|44,1|24,1|26,4|27,1|30,3|31,1|10,1|11,3|13,1|36,1|38,1|16,2|39,2|17,2|18,4|19,3|0,1|1,4|2,2|3,4|4,1|7,2|8,3|9,4|41,1|20,1|43,1|21,1",202104102313
202104102322,"0,150|1,210|2,300|3,320|4,360",10,"22,3|23,2|24,2|25,1|29,1|30,2|31,1|10,3|32,2|11,2|33,1|12,1|14,3|36,1|15,2|37,1|16,2|18,2|19,2|0,3|1,1|2,2|3,3|4,4|5,2|6,1|8,3|9,5|20,10|21,1",202104102322
202104102317,"0,170|1,230|2,340|3,350|4,410",10,"22,4|23,3|24,4|47,1|25,1|26,1|27,1|28,1|30,1|10,2|11,3|12,3|34,3|13,3|35,2|14,4|15,2|16,1|38,1|17,2|18,1|19,3|0,3|1,1|3,1|4,2|5,1|6,3|7,2|8,2|9,1|41,1|20,4|21,4",202104102317
202104102350,"0,140|1,210|2,230|3,250|4,310",10,"22,3|23,4|24,2|25,1|26,1|30,1|31,1|11,4|12,1|13,3|14,4|36,1|15,3|17,1|18,5|19,3|0,11|2,2|3,1|4,1|5,3|6,3|7,1|8,1|9,5|20,2|21,5",202104102350
202104110041,"0,210|1,280|2,390|3,400|4,420",10,"22,2|23,2|24,2|25,1|26,1|27,1|28,3|29,1|11,1|12,1|13,1|14,1|15,2|37,1|16,1|39,2|17,1|18,1|19,1|0,3|3,1|5,1|7,1|9,3|40,3|42,1|21,1",202104110041
202104102318,"0,160|1,250|2,350|3,390|4,420",10,"22,2|23,1|24,2|46,1|25,6|26,1|27,1|30,2|31,2|10,1|11,6|33,1|12,6|34,2|35,1|36,1|14,2|15,1|16,2|39,2|17,2|18,2|0,3|1,1|2,1|3,1|5,3|7,4|8,3|9,2|41,1|20,3|42,2|21,1",202104102318
202104102311,"0,160|1,240|2,300|3,370|4,420",10,"22,3|23,1|24,4|25,4|26,2|27,1|28,1|30,2|10,2|11,2|12,1|34,2|13,1|14,2|15,3|37,1|16,1|17,1|39,1|19,1|0,2|1,5|2,2|3,1|4,4|7,3|8,1|9,2|20,2|42,1|21,4|43,1",202104102311
202104102327,"0,170|1,260|2,290|3,320|4,350",10,"22,1|23,3|24,1|26,2|27,5|28,2|29,2|30,1|31,1|32,2|10,2|12,2|35,1|13,1|36,1|14,3|15,3|16,1|17,4|18,1|19,2|0,4|1,1|2,2|3,2|4,1|7,1|8,3|9,3|20,2|21,3",202104102327

```

### Superset query
```sql
--global response latency (percentile in ms)
select
  dd.id,
  to_timestamp(dd.id, 'YYYYMMDDHH24MI'),
  coalesce(substr(split_part(value, '|', 1), 3)::integer, 0) p50,
  coalesce(substr(split_part(value, '|', 2), 3)::integer, 0) p75,
  coalesce(substr(split_part(value, '|', 3), 3)::integer, 0) p90,
  coalesce(substr(split_part(value, '|', 4), 3)::integer, 0) p95,
  coalesce(substr(split_part(value, '|', 5), 3)::integer, 0) p99
from all_percentile ap
right join (
  select to_char(dd, 'YYYYMMDDHH24MI') id
  from generate_series (
    current_timestamp - '15 minutes'::interval,
    current_timestamp,
    '1 minute'::interval
  ) dd
) dd on (ap.id = dd.id);
```

### Equivalent graphs

![](misc/example.gif)
